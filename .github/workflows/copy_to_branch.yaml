on:
  push:
    branches: [master]
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch_depth: 0
      - run: |
          echo qbranch hiii
          git status
          git branch
          pwd
          PREFIX="prefix-"
          SRC_ROOT="$(pwd)"
          for FOLDER in foo bar; do
            echo "Doing ${FOLDER}"
            BRANCH="${PREFIX}${FOLDER}"
            git worktree add "../${FOLDER}" "origin/${BRANCH}"
            cd "../${FOLDER}"
            git rm -rf .
            cp -r "${SRC_ROOT}/${FOLDER}" .
            git add .
            git commit -m "Sync from ${{ github.sha }}"
            git push
            cd "${SRC_ROOT}"
          done
            
      
